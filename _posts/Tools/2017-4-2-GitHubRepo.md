---
layout: post
title: 发布一个GitHub仓库时需要注意的东西
category: Tools
tags: Misc
keywords: rust
description: How should I pulish my GitHub repo
---

本文全部源于我个人总结，绝对不保证权威性，反正我自己做到不坑你们，你们信不信就是你们的事了。另外，我自己是做到了遵守这些准则的。

GitHub对我来说是在自己没有工作的时候应该好好整出一个优秀的账号的网站，据说对以后找工作啥的有帮助。所以开仓库就一定要注意了，最近我看到很多人开仓库开的很暴力，而且在很早之前我就想过要写篇博客讲这个了，今天才填坑真是对不起。

**请大家期待我即将出的国内使用Gradle的正确姿势的教程，会有文字博客和视频教程。绝对天地良心，保证不坑，随后还会附带Travis CI的部署教程，也绝对保证不坑。**

**毕竟，教程要是坑，怎能带你入坑？**

## 什么是暴力开仓库

就是开很糟糕的仓库，放在开源界会被鄙视的项目。

这里排除IntelliJ-Community这种比较特殊的仓库，因为人家第一不怕网速慢，第二人家把包都放在仓库里面，免得各种版本不对，这是针对公司的做法
（比如你自己公司也用Git，那么这么做是无可厚非的，但是个人项目最好注意一下）。

这也是构建工具出现的原因——由于老是有库，版本还老是换，导致仓库太大了。

## 注意点

首先，一个稍微正常点的Git仓库都一定要注意的东西有：

+ 不要上传目标文件，除非你以非程序员为目标用户
+ 不要上传与仓库本身无关的文件（你需要gitignore）
+ 尽可能有LICENSE和README

### 为什么不要上传目标文件

先说一句，目标文件包含Code Generator生成的代码，比如Lex和Yacc生成的Lexer和Parser。

什么意思呢？举个例子，我有一个Java的仓库，
然后我把所有编译生成的*.class文件全部上传（注意是编译生成的，如果你有手写的字节码当我没说），这就很智障了。
你当用户是傻的啊。。。

0. 如果是想review你的代码，不需要看也无法看*.class的内容
0. 大量的*.class以及每次编译都导致的更新（因为你编译一次，对应的*.class也会变）会让仓库变得巨大（因为Git等同对待二进制文件），每次push都会很慢
0. 如果是想clone你的仓库，看见那巨大的仓库体积一般人都会知难而退
0. 几乎每次增量编译都会影响到Git监控，虽然目前我没遇到过不过这一定会导致后期git gc和git
commit很慢

这已经是十分充分的理由了。所以，JVM程序员把*.class，*.apk和*.jar加入gitignore吧；
Rust程序员把Cargo.lock和*.exe之类的加入gitignore吧；
Gradle用户把build目录和.gradle目录加入gitignore吧。

一般情况下，目标文件是放在GitHub的release界面的。
比如我之前看到过一个E站客户端，就是在release界面放了个apk。毕竟这种东西有时体积不能控制，但你又要面向不方便自己构建的人使用，那就在release里面放目标文件吧。

### 与仓库本身无关的文件

我觉得这没什么难理解的。

比如：

+ 我写了一个音乐播放器，我上传了我拿来测试的一堆wav/ape/flac文件了，只上传代码就好。
+ 我写了一个压缩工具，然后把我拿来测试的100多mb的文件上传上去了。
+ 我上传了.idea/workspace.xml
+ 我上传了测试用的.db文件

这都是不好的，而且为什么不好，我觉得用屁股想都想得到。

如果确实有这个需求怎么办呢？

举个例子，我要部署我的项目到某个CI（持续集成）上去，然而我的项目用到了JNI，
原本两部分（CMake和Gradle）是我手动分别编译，而且考虑到CMake设置编译器等各种猥琐流程，
考虑种种因素，我觉得最好的Solution是把JNI的dll/so/jnilib分别上传到Git远端仓库，这样就只需要让CI自动构建Gradle的部分就好了（因为CI涉及测试的自动化）。

#### 临时解决方案

我有一个替代解决方案。考虑到国内Git仓库，比如Coding.net和OSC的clone速度是相当之快的（我学校机房里的批网速（打开我的GitHub平均需要五秒）都能达到10mb/s的clone速度）。

这时我们就可以先在国内Git源开个仓库用来堆这种破玩意，然后使用Git的submodule来解决（submodule怎么用，自己股沟）。

#### 关于IntelliJ的workspace.xml

比较了解IntelliJ系的IDE的同学应该注意到过，.idea目录下有很多各种各样的配置，其中有一个巨大的workspace.xml，它的大小飘忽不定，不过一般在20kb到70kb之间。

这其实是IntelliJ的一个对你编辑状态的缓存，比如你复制粘贴了什么东西，
你剪切了什么东西，你光标怎么移动了一下，你Git commit时写了什么commit message，IntelliJ都会把这些存进去。

而且编辑时，这破玩意是会大大改变的，有时你代码都没动，它变了，你commit的时候就会无意中把这些commit进去，造成commit log和整个仓库的污染。

看完上面这段，你还会上传workspace.xml吗？ :joy:

### 尽可能有LICENSE和README

重要性我就不说了，LICENSE你懂得，这里推荐最邪恶的GPLv3.0，最不推荐MIT。协议怎么选，网上很多教程，我就不赘述了。

> MIT一时爽，**抄袭**火葬场。

README尽可能使用人性化的语言写，尽可能用英文写，里面一般包含：

+ 尽可能简洁的简介
+ 特色，吸引别人
+ 如果是软件类，放截图，可以考虑录制GIF
+ Wiki的链接
+ LICENSE
+ 装逼用的badge，比如CI，比如Gitter，比如CodeCov，比如CodeClimate
+ clone、build说明
+ 维护指北等各种指北的链接
+ release的binary的下载链接
+ 如果是库性质的，放构建工具远端仓库地址（比如JitPack，或者你牛逼，你上Maven Central）
+ Contributors

于是我就暂时介绍到这里，有什么欢迎发邮件通知我补充。

